var lcp=0;var player;var root;var PW;var PH;var PSH;var PTH;var PTW;var PSW;var _urlbase;var _upnum=0;var _readnum=1;var _fr=30;var _zoom=1;var globalaudio;var _margin=30;var transform_prop="transform";var aj2="transform-origin";var _hmt=_hmt||[];(function(){var hm=document.createElement("script");hm.src="//hm.baidu.com/hm.js?89322ef4389f974848da057c4dc0602c";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);var bp=document.createElement('script');bp.src='//push.zhanzhang.baidu.com/push.js';var s1=document.getElementsByTagName("script")[1];s1.parentNode.insertBefore(bp,s1)})();function recommendready(){var ispc=browserRedirect();if(ispc==true){}else{}}function isIos(){var sUserAgent=navigator.userAgent.toLowerCase();var bIsIpad=sUserAgent.match(/ipad/i)=="ipad";var bIsIphoneOs=sUserAgent.match(/iphone os/i)=="iphone os";if(bIsIpad||bIsIphoneOs){return true}return false}function isMobile(){var sUserAgent=navigator.userAgent.toLowerCase();var bIsIpad=sUserAgent.match(/ipad/i)=="ipad";var bIsIphoneOs=sUserAgent.match(/iphone os/i)=="iphone os";var bIsAndroid=sUserAgent.match(/android/i)=="android";var bIsWeixin=sUserAgent.match(/MicroMessenger/i)=="micromessenger";var bIsWM=sUserAgent.match(/windows mobile/i)=="windows mobile";if(bIsIpad||bIsIphoneOs||bIsAndroid||bIsWM){return true}return false}function browserRedirect(){return true;var sUserAgent=navigator.userAgent.toLowerCase();var bIsIpad=sUserAgent.match(/ipad/i)=="ipad";var bIsIphoneOs=sUserAgent.match(/iphone os/i)=="iphone os";var bIsAndroid=sUserAgent.match(/android/i)=="android";var bIsWeixin=sUserAgent.match(/MicroMessenger/i)=="micromessenger";var bIsWM=sUserAgent.match(/windows mobile/i)=="windows mobile";if(bIsIpad||bIsIphoneOs||bIsAndroid||bIsWM){return false}else{return true}}function getRecommend(){$.ajax({type:"post",url:"http://ts.whytouch.com/recommend.php",dataType:'json',data:{articleid:window.firsttag},error:function(data){document.getElementById('movie_rank').style.display="none"},success:function(data){if(data.error_id!=0||data.recommend.length==0){document.getElementById('movie_rank').style.display="none";return}document.getElementById('movie_rank').style.display="block";for(var i=0;i<data.recommend.length;i++){var ap=$("<tr><td>"+(i+1)+".<a href='https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxbefb2cda01c3f409&redirect_uri=http://ts.whytouch.com/wxforward.php&response_type=code&scope=snsapi_base&state="+data.recommend[i].uuid+"()"+window.firsttag+"**"+data.recommend[i].tag+"#wechat_redirect'>"+delExtension(data.recommend[i].filename)+"</a></td></tr>");ap.appendTo(".rank_list")}}})}function delExtension(str){var reg=/\.\w+$/;var name=str.replace(reg,'');if(name.length>20){name=name.substr(0,20);name=name+"..."}return name}function getComment(){$.ajax({type:"post",url:"http://ts.whytouch.com/comment.php",dataType:'json',data:{aid:window.firsttag,stype:"get"},error:function(data){},success:function(data){if(data.error_id==1){document.getElementById('comment').style.display="block";for(var i=0;i<data.ret.length;i++){$("<tr><th rowspan='2'><img src='"+data.ret[i].avatar+"' /></th><td class='nickname'>"+data.ret[i].nickname+"</td></tr><tr class='clearspace'><td class='content'>"+data.ret[i].content+"<br><span class='time'>"+getTimeInterval(data.ret[i].pub_tm)+"</span></td></tr><tr class='addspace'><td colspan='2'></td></tr>").appendTo(".tbcomment")}}}})}function getTimeInterval(ctime){var currdate=new Date();var dcurrdate=currdate.getTimezoneOffset()*60;var currtime=currdate.getTime();var formattimevalue=(transdate(ctime)-dcurrdate)*1000;var intervaltime=(currtime-formattimevalue)/1000;if(intervaltime>(3600*24*2)){return Math.floor(intervaltime/(24*3600))+"天前"}else if(intervaltime>(3600*24)){return"昨天"}else if(intervaltime>3600){return Math.floor(intervaltime/3600)+"小时前"}else if(intervaltime>60){return Math.floor(intervaltime/60)+"分钟前"}else{return"刚刚"}}function transdate(endTime){var date=new Date();date.setFullYear(endTime.substring(0,4));date.setMonth(endTime.substring(5,7)-1);date.setDate(endTime.substring(8,10));date.setHours(endTime.substring(11,13));date.setMinutes(endTime.substring(14,16));date.setSeconds(endTime.substring(17,19));return Date.parse(date)/1000}function formatdate(unix){var unixTimestamp=new Date(unix*1000);var str=unixTimestamp.toString();return unixTimestamp.toLocaleString()}function subComment(){var str=$("#commentcontent").val();if(str==""){alert("请填写留言内容！");return}if(str.length>50){alert("留言内容请控制在50字以内！");return}str=str.replace(/\r/ig," ");str=str.replace(/\n/ig," ");str=str.replace(/\"/ig,"\\\"");str=str.replace(/'/ig,"''");if(getCookie("whytouch_token_openid")!=""){$.ajax({type:"post",url:"http://ts.whytouch.com/comment.php",dataType:'json',data:{aid:window.firsttag,openid:getCookie("whytouch_token_openid"),content:str,stype:"sub"},error:function(data){alert("系统正忙，请稍后再试！");closesub()},success:function(data){if(data.error_id>0){$("<tr><th rowspan='2'><img src='"+data.avatar+"' /></th><td class='nickname'>"+data.nickname+"</td></tr><tr class='clearspace'><td class='content'>"+$("#commentcontent").val()+"<br><span class='time'>刚刚</span></td></tr><tr class='addspace'><td colspan='2'></td></tr>").prependTo(".tbcomment");closesub();if(data.error_id==2){$("#showqrcode img").attr("src","http://ts.whytouch.com/images/qrcode.jpg");document.getElementById("showqrcode").style.display="block"}}else{alert("系统正忙，请稍后再留言！ID:"+data.error_id)}}})}else{}}function showsub(){document.getElementById("subdiv").style.display="block";document.getElementById("root").style.display="none"}function closesub(){document.getElementById("root").style.display="block";document.getElementById("subdiv").style.display="none";location.href="#comment";var viewport=document.querySelector("meta[name=viewport]")}function checkWxOpenid(json){if(getCookie("whytouch_token_openid")){if((json.wtoption&0x8)==0)SettingComment()}else{if(isWeiXin()){var wxurl='https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxbefb2cda01c3f409&redirect_uri=http://ts.whytouch.com/wxforward.php&response_type=code&scope=snsapi_base&state='+firsttag+"()ReGetOpenid#wechat_redirect";location.href=wxurl}}}function SettingComment(){var cd=document.createElement("div");cd.setAttribute("id","comment");cd.style.marginTop="50px";cd.style.marginLeft="-3px";cd.innerHTML="<img src='http://ts.whytouch.com/images/icon_edit.png' /><a href='javascript:void(0);' onclick='showsub();'>写留言</a><table class='tbcomment' id='tbcomment' border='0'></table>";var p=document.getElementById("main");p.appendChild(cd);getComment();$("#comment").width($(window).width());document.getElementById('tbcomment').style.width=$("#comment").width()*0.95+"px";$('body').append("<div class='subdiv' id='subdiv'><h2 id='gettitle'>"+document.title+"</h2><span style='display: block;position:static;background-color: #fff;'><textarea class='frm_textarea' id='commentcontent' placeholder='留言将对所有人可见。'></textarea></span><div class='discuss_btn_wrp'><a class='btn btn_close btn_discuss btn_disabled' href='javascript:;' onclick='closesub();'>关闭</a><a class='btn btn_primary btn_discuss btn_disabled' href='javascript:;' onclick='subComment();'>提交</a></div></div>");$('body').append("<div id='showqrcode' style='display:none;position:fixed;width:300px;height:400px;left:50%;top:50%;margin-left:-150px;margin-top:-200px;border-radius:15px;background-color:#eaeaea;z-index:3;'><div style='width:200px;margin-left:50px;margin-top:20px;'><label style='word-wrap:break-word;word-break:break-all;'>关注我们微演示官方公众号您将会获得显示头像以及昵称的特权。<br>[长按二维码识别加关注]</label></div><img src='' width='200px' style='margin-left:50px;margin-top:150px;'/><div class='discuss_btn_wrp close'><a class='btn btn_close btn_discuss btn_disabled' style='width:auto;' href='javascript:;' onclick='document.getElementById(\"showqrcode\").style.display=\"none\";'>关闭</a></div></div>")}function isWeiXin(){var ua=window.navigator.userAgent.toLowerCase();if(ua.match(/MicroMessenger/i)=='micromessenger'){return true}else{return false}}function LoadPage(lp){var d=document.getElementById("s"+lp);if(!d)return;d.style.height=(PH/4)+"px";d.className="stadiv";d.style[transform_prop]="scale(0.25)";d.style[aj2]="0 0";d.style.zoom=_zoom*4;if(_note[lp].length>0){var dnote=document.createElement("div");dnote.className="stanote";dnote.style.width=PSW+"px";dnote.innerHTML="<p>"+_note[lp]+"</p>";if(d.nextSibling!=null){d.parentNode.insertBefore(dnote,d.nextSibling)}else{d.parentNode.appendChild(dnote)}}if(window._control&&window._control[lp].bkg!=null){d.style.background=window._control[lp].bkg}}function BeforePageLoad(){var isios=isIos();var spans=document.getElementsByTagName("span");for(var ii=0;ii<spans.length;ii++){var node=spans.item(ii);if(node.className.indexOf("vchar")>=0){if(node.children.length>0){var ypos=0;for(var i=0,Len=node.children.length;i<Len;i++){var sss=node.children[i];sss.style.left="0px";sss.style.top=ypos+"px";ypos+=sss.offsetHeight}continue}var T="";var ypos=0;var Text1=node.innerHTML.replace(/<.+?>/gim,'');var Text=new Array();for(i=0;i<Text1.length;i++){if(Text1[i]=='&'){var ix=i;var str="";while(Text1[ix]!=';'&&ix<Text1.length){str+=Text1[ix];ix++}str+=';';Text.push(str);i=ix}else{Text.push(Text1[i])}}node.innerHTML="";for(var i=0,Len=Text.length;i<Len;i++){var sss=document.createElement("span");sss.style.top=ypos+"px";sss.innerHTML=Text[i];node.appendChild(sss);ypos+=sss.offsetHeight}continue}if(isios){if(node.style["font-weight"]=="bold"){node.style["font-weight"]="normal"}}}}function SetBrowseHeight(){var iframeTag=document.createElement('iframe');var iframeSrc=_urlbase+'iframec.php#';var lkn=document.getElementById("movie_rank");if(lkn==null){var pageHeight=document.documentElement.scrollHeight||document.body.scrollHeight}else{pageHeight=0;while(lkn!=document.body){pageHeight+=lkn.offsetTop;lkn=lkn.parentNode}}iframeTag.src=iframeSrc+(pageHeight+_margin)+"#"+PW;iframeTag.style.display='block';iframeTag.width="0";iframeTag.style.display="none";document.body.appendChild(iframeTag);}function AudioEnd(evt){var t=evt.target;t.pause();t.currentTime=0;for(var i=mmedias.length-1;i>=0;i--){if(mmedias[i].o==t.parentNode){t.play()}}}var css=function(el,props){var key,pkey;for(key in props){if(props.hasOwnProperty(key)){pkey=pfx(key);if(pkey!==null){el.style[pkey]=props[key]}}}return el};var pfx=(function(){var style=document.createElement('dummy').style,prefixes='-webkit- -moz- -o- -ms-'.split(' '),memory={};return function(prop){if(typeof memory[prop]==="undefined"){var ucProp=prop.charAt(0).toLowerCase()+prop.substr(1),props=(prop+' '+prefixes.join(ucProp+' ')+ucProp).split(' ');memory[prop]=null;for(var i in props){if(style[props[i]]!==undefined){memory[prop]=props[i];break}}}return memory[prop]}})();function Resize(){PSW=(document.documentElement.clientWidth-_margin>PW?PW:document.documentElement.clientWidth-_margin);zoom=PSW/PW;var agent=navigator.userAgent.toLowerCase();if(agent.indexOf("msie 9.0")>=0){zoom=1}_zoom=zoom;var lp=0;var d=document.getElementById("s"+lp);while(d){d.style.zoom=zoom*4;lp++;d=document.getElementById("s"+lp)}var wstr=PSW+"px";d=document.getElementsByClassName("stanote");for(var i=0;i<d.length;i++){d[i].style.width=wstr}d=document.getElementById("ad");if(d){var scalenum=PSW/728;if(scalenum>1)scalenum=1;d.style[transform_prop]="scale("+(scalenum)+")";d.style.width=wstr}d=document.getElementById("movie_rank");if(d)d.style.width=wstr;d=document.getElementById("rest");if(d)d.style.width=wstr;d=document.getElementById("tail");if(d)d.style.width=wstr;d=document.getElementById("_title");if(d)d.style.width=wstr}window.onresize=function(){if(!player)player=document.getElementById("main");if(!player)return;Resize()};function setCookie(name,value,day){var Days=day;var exp=new Date();exp.setTime(exp.getTime()+Days*24*60*60*1000);document.cookie=name+"="+escape(value)+";expires="+exp.toGMTString()}function delCookie(name){var exp=new Date();exp.setTime(exp.getTime()-1);var cval=getCookie(name);if(cval!=null){document.cookie=name+"="+cval+";expires="+exp.toGMTString()}}function getCookie(name){var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");if(arr=document.cookie.match(reg)){return unescape(arr[2])}else{return null}}var $_GET=(function(){var url=window.document.location.href.toString();var u=url.split("?");if(typeof(u[1])=="string"){u=u[1].split("&");var get={};for(var i in u){var j=u[i].split("=");get[j[0]]=j[1];if(j[0]=="bid"){return get}}return get}else{return{}}})();function Domready(fn){if(document.addEventListener){document.addEventListener('DOMContentLoaded',function(){document.removeEventListener('DOMContentLoaded',arguments.callee,false);fn()},false)}else if(document.attachEvent){document.attachEvent('onreadystatechange',function(){if(document.readyState=='complete'){document.detachEvent('onreadystatechange',arguments.callee);fn()}})}}Domready(function(){_urlbase="http://ts.whytouch.com/";var jd=navigator.userAgent.toLowerCase();if(jd.indexOf("android")>=0||jd.indexOf("iphone")>=0||jd.indexOf("ipad")>=0){transform_prop="-webkit-transform";aj2="-webkit-transform-origin"}StartLoading()});var xmlHttpRequest;function Ajax(method,url,callback){if(window.XMLHttpRequest){xmlHttpRequest=new XMLHttpRequest();xmlHttpRequest.callback=callback;if(xmlHttpRequest.overrideMimeType){xmlHttpRequest.overrideMimeType("text/xml")}}if(xmlHttpRequest){xmlHttpRequest.onreadystatechange=AjaxCallback;xmlHttpRequest.open(method,url,true);xmlHttpRequest.send(null)}}function AjaxCallback(){if(xmlHttpRequest.readyState==4){if(xmlHttpRequest.status==200){xmlHttpRequest.callback(xmlHttpRequest.responseText)}}}function GetCount(_json){var pw=PW*_zoom;if(_json==""||_json[0]=='<'){var json={read:0,up:0,vip:0,readfee:0,wtoption:0}}else{var json=_json}if(window.rest==1){var d2=document.createElement("div");d2.id="rest";d2.className="rest";d2.style.width=pw+"px";d2.innerHTML="<p onclick='getrest()'>余下全文</p>";if(json.readfee>0){d2.innerHTML="<p onclick='getrest()' class='media_tool_meta tips_global meta_extra' style='margin-right:10px;padding:0 10px;line-height: 40px;border:1px solid #fff;background-color:#3fba93;color:#fff;border-radius:3px;font-size:14px;' >付费阅读余下全文<img src='../../images/icon24.png' width='18px' style='position:relative;top:4px;left:5px;'/></p>"}var pp=document.getElementById("main");pp.appendChild(d2);var autorest=parseInt(json.wtoption)&0x01;if(autorest==1&&json.vip>=5){getrest()}}if(json.slg!="")json.slgn=json.slg.split("##");else if(json.vip<9)json.slgn=["[微演示]PPT/PDF轻松发手机","百度'微演示',PPT轻松发手机。",""];if(json.slgn)document.getElementById("loading").firstChild.innerHTML=json.slgn[0];if(json.vip<8){var ispc=browserRedirect();if(true||ispc==false){var ad=document.createElement("div");ad.id="ad";ad.style.position="relative";var scalenum=(PSW+20)/728;if(scalenum>1)scalenum=1;ad.style[transform_prop]="scale("+(scalenum)+")";ad.style[aj2]="0 0";ad.style.width=(PSW+20)+"px";player.appendChild(ad);$("<div style='position:relative;padding:15px 0 15px 0;left:-10px;'><script async src='\/\/pagead2.googlesyndication.com/pagead/js/adsbygoogle.js'></script><!-- h5-2 --><ins class='adsbygoogle' style='display:inline-block;width:728px;height:90px' data-ad-client='ca-pub-1207270105884136' data-ad-slot='6169036585'></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div>").appendTo($('#ad'))}}var d=document.createElement("div");d.className="rich_media_tool";d.setAttribute("id","tail");d.style.width="100%";var tmpstr="";if(json.fee==-1){if(json.vip!=9)tmpstr="<a class='media_tool_meta tips_global meta_extra' href='http://ts.whytouch.com/'>微演示</a>"}else{tmpstr="<a class='media_tool_meta tips_global meta_extra' style='margin-right:10px;padding:0 10px;line-height: 25px;border:1px solid #04be02;background-color:#09BB07;color:#fff;border-radius:3px;font-size:14px;' href='javascript:void(0);' onclick='PayDown();'>下载原文<img src='../../images/icon24.png' width='18px' style='position:relative;top:4px;left:5px;'/></a>"}d.innerHTML="<span class='media_tool_meta meta_primary'>阅读 "+json.read+"<i class='icon_praise_gray' id='likebtn' onclick='UpNum()'></i><span class='praise_num' id='likenum'>"+json.up+"</span></span>"+tmpstr;player.appendChild(d);var rd=document.createElement("div");rd.setAttribute("id","movie_rank");rd.style.marginTop="60px";rd.className="box2";rd.style.width=pw+"px";if(!json.slgn){}else{rd.innerHTML="<div class='inner'><a href='"+json.slgn[2]+"'><span>"+json.slgn[1]+"</span></a><table class='rank_list' cellspacing='20'></table></div>"}player.appendChild(rd);checkWxOpenid(json);recommendready();if(document.referrer&&document.referrer.indexOf(_urlbase+"browse")>=0){setTimeout(SetBrowseHeight,1000)}}function UpNum(){var haszan=getCookie(window.firsttag+"zan");if(haszan!=null)return;var obj=document.getElementById("likebtn");if(obj.className.indexOf("praised")>0)return;obj.className+=" praised";var obj=document.getElementById("likenum");obj.innerHTML=parseInt(obj.innerHTML)+1;var upok=function(json){};Ajax("Get",_urlbase+"upnum.php?tag="+window.firsttag,upok);setCookie(window.firsttag+"zan",1,365)}function setZoom(){PSH=document.documentElement.clientHeight;if(document.referrer&&document.referrer.indexOf(_urlbase+"browse")>=0){PSH=640}var zoom;PTH=0;PTW=0;PSW=(document.documentElement.clientWidth-_margin>PW?PW:document.documentElement.clientWidth-_margin);zoom=PSW/PW;var agent=navigator.userAgent.toLowerCase();if(agent.indexOf("msie 9.0")>=0){_zoom=1}else{_zoom=zoom}}function StartLoading(){player=document.getElementById("main");root=document.getElementById("root");if(window.optjson){GetCount(window.optjson)}PW=parseFloat(player.style.width);PH=parseFloat(player.style.height);player.style.top="0px";player.style.left="0px";player.style.position="relative";player.style.width="100%";player.style.height="";var d=document.createElement("div");d.className="statitle";d.setAttribute("id","_title");d.style.width=d.innerHTML="<h2 class='rich_media_title'>"+_title+"</h2><div class='rich_media_meta_list'><em id='post-date' class='rich_media_meta rich_media_meta_text'>"+_pubtm+"</em> <a class='rich_media_meta rich_media_meta_link rich_media_meta_nickname' href='"+_urlbase+"getauthorlink.php?aut="+_author+"&tag="+window.firsttag+"' id='post-user'>"+_author+"</a> </div>";player.insertBefore(d,player.firstChild);root.style["margin-left"]=(_margin/2-2)+"px";setZoom();d.style.width=PSW+"px";var haszan=getCookie(window.firsttag+"read");if(haszan==null){Ajax("Get",_urlbase+"getstat2.php?tag="+window.firsttag,function(json){});setCookie(window.firsttag+"read",1,365)}{haszan=getCookie(window.firsttag+"zan");if(haszan!=null){var obj=document.getElementById("likebtn");if(obj&&obj.className.indexOf("praised")<0){obj.className+=" praised";var obj=document.getElementById("likenum");obj.innerHTML=window.optjson.up}}}if(document.referrer&&document.referrer.indexOf(_urlbase+"browse")>=0){setTimeout(SetBrowseHeight,3000)}BeforePageLoad();var slen=(window.rest==1)?5:_note.length;for(var si=0;si<slen;si++){LoadPage(si)}var t=document.getElementsByTagName("audio");for(i=0;i<t.length;i++){t[i].parentNode.isv=1}if(pptcolor!=null){document.body.style.background=pptcolor}setTimeout(function(){player.style.visibility="";var loading=document.getElementById("loading");loading.style.display="none"},2000)}function LoadRestPage(){BeforePageLoad();for(var si=5;si<_note.length;si++){LoadPage(si)}}function Fill(rest){switch(rest){case"#*pay*#":if(isWeiXin()){document.getElementById("loadingToast").style.display="block";location.href="http://ts.whytouch.com/testwxpay/index.php?uuid="+window.firsttag+"&state=read"}else{alert("请在微信内打开此页面！")}break;case"#*no_openid*#":if(isWeiXin()){alert("页面需要重新刷新，刷新后请重新点击余下全文。");location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxbefb2cda01c3f409&redirect_uri=http://ts.whytouch.com/wxforward.php&response_type=code&scope=snsapi_base&state="+window.firsttag+"()getopenid#wechat_redirect"}else{document.getElementById("rest").innerHTML="请在微信中访问";alert("请在微信内打开此页面！")}break;case"#*wr_fee*#":case"#*no_uuid*#":case"#*no_tag*#":document.getElementById("rest").innerHTML="参数错误";break;default:var d=document.createElement("div");d.style.position="relative";d.innerHTML=rest;var re=document.getElementById("rest");player.insertBefore(d,re);player.removeChild(re);LoadRestPage();if(document.referrer&&document.referrer.indexOf(_urlbase+"browse")>=0){SetBrowseHeight()}break}}function getrest(){var obj=document.getElementById("rest");obj.className+=" restgray";obj.innerHTML="加载中...";$.ajax({type:"get",url:_urlbase+"getrest_ppt.php?tag="+window.firsttag,error:function(data){},success:function(data){Fill(data)}})}function playmedia(i){var t;if(window.event){tar=gettarget(window.event);t=tar.getElementsByTagName(i==1?"audio":"video");if(t.length>0){if(t[0].paused){t[0].play();}else{t[0].pause();}}}ahp=1;}function hp(a,obj){if(a.indexOf("http")==0||a.indexOf("mailto")==0){window.open(a)}else if(a.indexOf("tel:")>=0||a.indexOf("sms:")>=0){window.open(a)}}function setCookie(name,value,day){var Days=day;var exp=new Date();exp.setTime(exp.getTime()+Days*24*60*60*1000);document.cookie=name+"="+escape(value)+";expires="+exp.toGMTString()}